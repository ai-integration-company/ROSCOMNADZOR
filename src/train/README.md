# Обучение нейронной сети

Эта папка содержит файлы для обучения нейронной сети, создающей эмбеддинги для изображений.

## Рекомендации по обучению

Рекомендуется использовать обучение без описаний, поскольку оно более стабильно. Однако, если вы хотите использовать описания, следуйте инструкциям ниже.

## Обучение без описаний (без BLIP)

Для запуска обучения без описаний выполните следующий bash-скрипт:

```bash
bash train.sh
```


### Аргументы

| Аргумент             | Тип    | По умолчанию                 | Описание                     |
|----------------------|--------|------------------------------|------------------------------|
| `--image_dir`        | `str`  | `../sekrrno/dataset`         | Каталог с изображениями      |
| `--epochs_dir`       | `str`  | `./epochs_new_night`         | Каталог для сохранения эпох  |
| `--embedding_size`   | `int`  | `64`                         | Размер эмбеддинга            |
| `--m_per_batch_size` | `int`  | `8`                          | Размер mini-batch            |
| `--batch_size`       | `int`  | `256`                        | Размер batch                 |
| `--load_last`        | `bool` | `True`                       | Загрузить последнюю модель   |

## Обучение с использованием описаний (с BLIP)

### Генерация описаний

Сначала сгенерируйте описания для изображений с помощью модели BLIP, выполнив следующий скрипт:

```bash
bash captioning.sh
```


#### Аргументы

| Аргумент         | Тип   | Описание                              |
|------------------|-------|---------------------------------------|
| `--image_dir`    | `str` | Путь к каталогу с изображениями       |
| `--output_file`  | `str` | Путь к выходному JSON-файлу           |

### Преобразование описаний в векторы

После генерации описаний выполните скрипт для преобразования их в вектора:

```bash
bash embedding_blip.sh
```

#### Аргументы

| Аргумент         | Тип   | Описание                                       |
|------------------|-------|------------------------------------------------|
| `--inputjson     |  str  | Путь к входному JSON-файлу с текстами          |
| --outputjson`    | `str` | Путь к выходному JSON-файлу                    |
| `--batchsize     |  int  | Размер batch для обработки текстов             |
| --task           |  str  | Тип задачи для модели (например, "text-matching") |

### Обучение с описаниями

Запустите обучение с использованием описаний, выполнив следующий скрипт:

```bash
bash trainwithcaptions.sh
```


#### Аргументы

| Аргумент             | Тип    | По умолчанию          | Описание                     |
|----------------------|--------|-----------------------|------------------------------|
| `--image_dir`        | `str`  | `../sekrrno/dataset`  | Каталог с изображениями      |
| `--epochs_dir`       | `str`  | `./epochs_emb`        | Каталог для сохранения эпох  |
| `--embedding_size`   | `int`  | `32`                  | Размер эмбеддинга            |
| `--m_per_batch_size` | `int`  | `4`                   | Размер mini-batch            |
| `--batch_size`       | `int`  | `512`                 | Размер batch                 |
| `--load_last`        | `bool` | `False`               | Загрузить последнюю модель   |
